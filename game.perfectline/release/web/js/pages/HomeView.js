var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),HomeView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ui=new ui.common.HomeViewUI,e.recommendApp=null,e._btns=[],e}return __extends(e,t),e.prototype.show=function(){t.prototype.show.call(this),this.ui.chapList.refresh(),this.updateUserInfo(),this.onStageResize()},e.prototype.onStageResize=function(){var t=Math.max(Laya.stage.width/AppConfig.AppWidth,Laya.stage.height/AppConfig.AppHeight);this.ui.bg.scale(t,t)},e.prototype.close=function(){Star.destroy(),t.prototype.close.call(this)},e.prototype.showBtns=function(){for(var t=0,e=0;e<this._btns.length;e++)this._btns[e].visible&&(this._btns[e].x=110*t,t++)},e.prototype.format=function(t){trace("format:::::",t),this.ui.tfName.text=t.name+"",this._isLocked=void 0==User.instace.starInfo[t.id],void 0!=User.instace.starInfo[t.id]?(this.ui.star.visible=!0,this.ui.condBox.visible=!1,this.ui.btnPlay.visible=!0,this.ui.btnUnlock.visible=!1,this.ui.tfScore.text=User.instace.starInfo[t.id]+"%"):(this.ui.star.visible=!1,this.ui.condBox.visible=!0,this.ui.btnPlay.visible=!1,this.ui.btnUnlock.visible=!0,this.ui.tfItemNum.text=Bag.getInstance().getItemNum(t.cond[0])+"/"+t.cond[1])},e.prototype.onBtnClick=function(t){switch(t.stopPropagation(),t.target){case this.ui.btnDev:XFacade.instance.showModule(DevView);break;case this.ui.btnSignin:XFacade.instance.showModule(SignInView);break;case this.ui.roleBtn:XFacade.instance.showModule(RoleView);break;case this.ui.btnAddPower:XFacade.instance.showModule(PopAddPower);break;case this.ui.btnUserInfo:XFacade.instance.showModule(UserInfoView);break;case this.ui.btnPlay:User.instace.power>0?(XFacade.instance.showModule(GameView,this.ui.chapList.selectedItem),User.instace.curId=this.ui.chapList.selectedItem.id):XFacade.instance.showModule(PopAddPower);break;case this.ui.btnUnlock:this.unlock()}},e.prototype.showTip=function(t){switch(t.stopPropagation(),t.target){case this.ui.diaMC:xframe.XTipManager.showTip(DBItem.getItemVo(ItemVo.DIAMOND),Tip);break;case this.ui.goldMC:xframe.XTipManager.showTip(DBItem.getItemVo(ItemVo.GOLD),Tip);break;case this.ui.powerMC:xframe.XTipManager.showTip(DBItem.getItemVo(ItemVo.POWER),Tip)}},e.prototype.unlock=function(){var t=this._selectedItem.dataSource.id,e=DBChapter.getChapInfo(t);if(DBChapter.canUnlock(t))User.instace.starInfo[t]=0,this.ui.chapList.refresh(),this.format(this._selectedItem.dataSource),Bag.getInstance().delItem(e.cond[0],e.cond[1]),XTip.showTip("《"+e.name+"》解锁成功，赶紧去挑战吧");else{var i=DBItem.getItemVo(e.cond[0]),s=e.cond[1]-Bag.getInstance().getItemNum(i.id),n="解锁《"+e.name+"》需要"+i.name+"x"+e.cond[1]+",您当前拥有"+Bag.getInstance().getItemNum(i.id);n+="，还需要支付"+10*s+"钻石",XAlert.showAlert(n,Laya.Handler.create(this,this.doUnlock,[t,i.id,e.cond[1]]),null,!0,!0,"解锁","取消")}},e.prototype.doUnlock=function(t,e,i){var s=DBChapter.getChapInfo(t),n=Bag.getInstance().getItemNum(e),o=10*(i-n);User.instace.diamond<o?XTip.showTip("哎呀~钻石不够了呢"):(User.instace.starInfo[t]=0,User.instace.diamond-=o,Bag.getInstance().delItem(e,n),this.ui.chapList.refresh(),this.format(this._selectedItem.dataSource),XTip.showTip("《"+s.name+"》解锁成功，赶紧去挑战吧"))},e.prototype.onItemClick=function(t,e){t.type==Laya.Event.CLICK&&(e==this.ui.chapList.selectedIndex?this._isLocked?this.unlock():XFacade.instance.showModule(GameView,this.ui.chapList.selectedItem):this.scrollToIndex(e-1))},e.prototype.onScroll=function(){var t=Math.round(this.ui.chapList.scrollBar.value/300);this.scrollToIndex(t)},e.prototype.createUI=function(){t.prototype.createUI.call(this),wx.showShareMenu({withShareTicket:!0}),this.ui.chapList.array=[null].concat(DBChapter.chapList,[null]),this.ui.chapList.hScrollBarSkin="",this.ui.chapList.scrollBar.elasticBackTime=100,this.ui.chapList.scrollBar.rollRatio=.7,this.ui.chapList.selectedIndex=1,this.selectedItem=this.ui.chapList.getCell(1),this._btns.push(this.ui.roleBtn,this.ui.btnSignin),this.ui.roleBtn.visible=AppConfig.openShop},e.prototype.scrollToIndex=function(t){this.ui.chapList.tweenTo(t),this.ui.chapList.selectedIndex=t+1,this.selectedItem=this.ui.chapList.getCell(t+1)},Object.defineProperty(e.prototype,"selectedItem",{set:function(t){this._selectedItem!=t&&(this._selectedItem&&(this._selectedItem.selected=!1),this._selectedItem=t,this._selectedItem&&(this._selectedItem.selected=!0,this.format(this._selectedItem.dataSource)))},enumerable:!0,configurable:!0}),e.prototype.updateUserInfo=function(){this.ui.coinNum.text=User.instace.gold+"",this.ui.starNum.text=User.instace.diamond+"",this.ui.heartNum.text=User.instace.power+"",this.ui.btnAddPower.visible=User.instace.power<30,this.ui.btnUserInfo.skin=User.instace.avatar,this._selectedItem&&this._selectedItem.dataSource&&(this.ui.tfScore.text=User.instace.starInfo[this._selectedItem.dataSource.id]+"%"),this.ui.btnSignin.visible=User.instace.canSign,this.showBtns()},e.prototype.initEvent=function(){this.ui.btnDev.on(Laya.Event.CLICK,this,this.onBtnClick),this.ui.btnSignin.on(Laya.Event.CLICK,this,this.onBtnClick),this.ui.roleBtn.on(Laya.Event.CLICK,this,this.onBtnClick),this.ui.btnAddPower.on(Laya.Event.CLICK,this,this.onBtnClick),this.ui.btnUserInfo.on(Laya.Event.CLICK,this,this.onBtnClick),this.ui.btnPlay.on(Laya.Event.CLICK,this,this.onBtnClick),this.ui.btnUnlock.on(Laya.Event.CLICK,this,this.onBtnClick),this.ui.diaMC.on(Laya.Event.CLICK,this,this.showTip),this.ui.goldMC.on(Laya.Event.CLICK,this,this.showTip),this.ui.powerMC.on(Laya.Event.CLICK,this,this.showTip),XEvent.instance.on(User.UPDATE,this,this.updateUserInfo),this.ui.chapList.mouseHandler=Laya.Handler.create(this,this.onItemClick,null,!1),this.ui.chapList.scrollBar.on(Laya.Event.END,this,this.onScroll)},e.prototype.removeEvent=function(){this.ui.btnDev.off(Laya.Event.CLICK,this,this.onBtnClick),this.ui.btnSignin.off(Laya.Event.CLICK,this,this.onBtnClick),this.ui.roleBtn.off(Laya.Event.CLICK,this,this.onBtnClick),this.ui.btnAddPower.off(Laya.Event.CLICK,this,this.onBtnClick),this.ui.btnUserInfo.off(Laya.Event.CLICK,this,this.onBtnClick),this.ui.btnPlay.off(Laya.Event.CLICK,this,this.onBtnClick),this.ui.btnUnlock.off(Laya.Event.CLICK,this,this.onBtnClick),this.ui.diaMC.off(Laya.Event.CLICK,this,this.showTip),this.ui.goldMC.off(Laya.Event.CLICK,this,this.showTip),this.ui.powerMC.off(Laya.Event.CLICK,this,this.showTip),XEvent.instance.off(User.UPDATE,this,this.updateUserInfo),this.ui.chapList.mouseHandler.recover(),this.ui.chapList.mouseHandler=null,this.ui.chapList.scrollBar.off(Laya.Event.END,this,this.onScroll)},e}(xframe.XWindow);