var Bag=function(){function t(){this.index=1,this.items=[]}return t.prototype.init=function(){var t=XDB.getData(XDB.BAG);t?("string"==typeof t&&(t=JSON.parse(t)),this.update(t)):AppConfig.platfrom==AppConfig.Plat4399&&(this.addItem(ItemVo.GOLD,8888),this.addItem(ItemVo.DIAMOND,888),this.addItem(ItemVo.KEY,15),this.addItem(ItemVo.POWER,10))},t.prototype.createItem=function(t,e){void 0===e&&(e=1);var i;return DBItem.getItemVo(t)?i={uid:this.index++,itemId:t,num:Math.floor(e)}:XTip.showTip("道具Id"+t+"不存在"),i},t.prototype.addItem=function(t,e){void 0===e&&(e=1);var i=DBItem.getItemVo(t);if(i){if(t==ItemVo.GOLD)return User.instace.gold+=Math.floor(e),User.instace.dispatchEvent(),void User.instace.save();if(t==ItemVo.DIAMOND)return User.instace.diamond+=Math.floor(e),User.instace.dispatchEvent(),void User.instace.save();if(t==ItemVo.POWER)return User.instace.power+=Math.floor(e),User.instace.dispatchEvent(),void User.instace.save();if(1==i.max)this.items.push(this.createItem(t,e));else{for(var s=!1,n=0;n<this.items.length;n++)if(this.items[n].itemId==t){this.items[n].num+=Math.floor(e),s=!0;break}s||this.items.push(this.createItem(t,e))}this.dispatchEvent(),this.save()}else XTip.showTip("无效道具ID:"+t)},t.prototype.getItemById=function(t){for(var e=0;e<this.items.length;e++)if(this.items[e].itemId==t)return this.items[e];return null},t.prototype.getItemByUid=function(t){for(var e=0;e<this.items.length;e++)if(this.items[e].uid==t)return this.items[e];return null},t.prototype.getItemNum=function(t){if(t==ItemVo.GOLD)return User.instace.gold;if(t==ItemVo.DIAMOND)return User.instace.diamond;for(var e=0,i=0;i<this.items.length;i++)this.items[i].itemId==t&&(e+=Math.floor(this.items[i].num));return e},t.prototype.delItem=function(t,e){if(t!=ItemVo.GOLD)if(t!=ItemVo.DIAMOND){for(var i=0;i<this.items.length;i++)if(this.items[i].itemId==t){this.items[i].num-=Math.floor(e),this.items[i].num<1&&this.items.splice(i,1);break}this.dispatchEvent(),this.save()}else User.instace.diamond-=e;else User.instace.gold-=e},t.prototype.delItemByUid=function(t,e){for(var i=0;i<this.items.length;i++)if(this.items[i].uid==t){this.items[i].num-=Math.floor(e),this.items[i].num<1&&this.items.splice(i,1);break}this.dispatchEvent(),this.save()},t.prototype.update=function(t){for(var e in t)this[e]=t[e]},t.prototype.save=function(){XDB.save(XDB.BAG,this)},t.prototype.dispatchEvent=function(){XEvent.instance.event(User.UPDATE)},t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.CHANGE="change",t}();