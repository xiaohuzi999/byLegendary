var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),HomeView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ui=new ui.pages.HomePageUI,e.recommendApp=null,e}return __extends(e,t),e.prototype.show=function(){t.prototype.show.call(this)},e.prototype.createUI=function(){var e=this;t.prototype.createUI.call(this),wx.showShareMenu({withShareTicket:!0}),this.ui.btnDev.on(Laya.Event.CLICK,null,function(){e.navigate(DevActivity)}),this.ui.actionView.btnStart.on(Laya.Event.CLICK,null,function(){var t=e.ui.actionView.chapList.selectedItem;e.navigate(GameActivity,t),GameDataManager.instance.recordLastChapter(t.id)}),this.ui.actionView.btnRank.on(Laya.Event.CLICK,null,function(){yxmp.report.event("1000_1003_click"),RankPop.show(!0)}),this.ui.actionView.btnSignin.on(Laya.Event.CLICK,null,function(){yxmp.report.event("1000_1006_click"),SigninPop.show(!0)}),this.ui.actionView.roleBtn.on(Laya.Event.CLICK,null,function(){yxmp.report.event("1000_1005_click"),Tape.PopManager.showPop(RoleList)}),this.ui.actionView.btnAddPower.on(Laya.Event.CLICK,null,function(){yxmp.report.event("1000_1007_click"),PopAddPower.show(null,function(){e.updateTopUi()})}),this.ui.actionView.btnUserInfo.on(Laya.Event.CLICK,null,function(){PopUserInfo.show()}),this.ui.recommendImg.on(Laya.Event.CLICK,null,function(){e.clickRecommend()}),this.ui.actionView.cardBtn.on(Laya.Event.CLICK,null,function(){yxmp.report.event("1000_1004_click"),e.navigate(MusicCard)}),this.ui.actionView.btnInvite.on(Laya.Event.CLICK,null,function(){var t=e.ui.actionView.chapList.selectedItem;yxmp.report.event("1000_1002_click",{id:t.id});var i=yxmp.plugin.help.getShareOptions(helpUnlock+t.id,yxmp.asset.getShareMessage("1000_1002_click","1003"));wx.shareAppMessage(i)}),this.ui.actionView.btnMore.on(Laya.Event.CLICK,null,function(){}),Laya.stage.on(noticficationRefreshMainData,this,function(){e.updateTopUi()}),GameDataManager.instance.fristOpen?(SigninPop.autoFlag=!0,Tape.PopManager.showPop(SigninPop)):Laya.stage.on(noticficationShowSign,this,function(){SigninPop.autoFlag=!0,Tape.PopManager.showPop(SigninPop)}),XEvent.instance.on(GameEvent.HOMECHAPTER,null,function(t,i){void 0===i&&(i=null);var n=GameDataManager.instance.nearestPlayChapterIndex();e.scrollToIndex(n+1)},[GameEvent.HOMECHAPTER]),this.ui.actionView.chapList.array=[null].concat(GameDataManager.instance.modeList,[{cover:"https://s.xiuwu.me/perfectline/res/map/futureChapter.png"},null]),this.ui.actionView.chapList.hScrollBarSkin="",this.ui.actionView.chapList.scrollBar.elasticBackTime=100,this.ui.actionView.chapList.scrollBar.rollRatio=.7,this.ui.actionView.chapList.selectedIndex=1,this.checkCurrentModeStatus(),this.selectedItem=this.ui.actionView.chapList.getCell(1),this.ui.actionView.chapList.scrollBar.on(Laya.Event.END,null,function(){var t=Math.round(e.ui.actionView.chapList.scrollBar.value/480);e.scrollToIndex(t)}),this.ui.actionView.chapList.mouseHandler=Laya.Handler.create(null,function(t,i){t.type==Laya.Event.CLICK&&(i==e.ui.actionView.chapList.selectedIndex?e.ui.actionView.btnStart.visible?e.ui.actionView.btnStart.event(Laya.Event.CLICK):e.ui.actionView.btnInvite.visible&&e.ui.actionView.btnInvite.event(Laya.Event.CLICK):e.scrollToIndex(i-1))},null,!1),Laya.stage.on(refreshModelList,this,function(){e.ui.actionView.chapList.array=[null].concat(GameDataManager.instance.modeList,[{cover:"https://s.xiuwu.me/perfectline/res/map/futureChapter.png"},null]),e.checkCurrentModeStatus(),e.ui.actionView.chapList.selectedIndex=GameDataManager.instance.nearestPlayChapterIndex(),e.scrollToIndex(GameDataManager.instance.nearestPlayChapterIndex())}),XEvent.instance.on(RoleList.UPDATE,null,function(){e.updateTopUi()})},e.prototype.scrollToIndex=function(t){this.ui.actionView.chapList.tweenTo(t),this.ui.actionView.chapList.selectedIndex=t+1,this.selectedItem=this.ui.actionView.chapList.getCell(t+1),this.checkCurrentModeStatus()},Object.defineProperty(e.prototype,"selectedItem",{set:function(t){this._selectedItem!=t&&(this._selectedItem&&(this._selectedItem.selected=!1),this._selectedItem=t,this._selectedItem&&(this._selectedItem.selected=!0))},enumerable:!0,configurable:!0}),e.prototype.checkCurrentModeStatus=function(){var t=this.ui.actionView.chapList.selectedItem;t&&this.updateGameStatus(t)},e.prototype.updateTopUi=function(){this.ui.actionView.coinNum.text=UserInfoManager.instace.userInfo.coin+"",this.ui.actionView.starNum.text=UserInfoManager.instace.userInfo.star+"",this.ui.actionView.heartNum.text=UserInfoManager.instace.userInfo.power+"",this.ui.actionView.btnAddPower.visible=UserInfoManager.instace.userInfo.power<30,this.ui.actionView.btnUserInfo.skin=UserInfoManager.instace.userInfo.avatarUrl},e.prototype.updateGameStatus=function(t){if(!t.id)return this.ui.actionView.conditionLabel.text="",this.ui.actionView.conditionStar.visible=!1,this.ui.actionView.btnStart.visible=!1,this.ui.actionView.btnInvite.visible=!1,void(this.ui.actionView.modeLabel.text="敬请期待");var e=GameDataManager.instance.checkModeIslock(t.id),i=0;if(e.length>0&&(i=e[0]),this.ui.actionView.modeLabel.text=t.name,1==i)this.ui.actionView.conditionLabel.text="收集      "+e[1]+"可解锁",this.ui.actionView.conditionStar.x=400,this.ui.actionView.conditionStar.visible=!0,this.ui.actionView.btnStart.visible=!1,this.ui.actionView.btnInvite.visible=!1,this.ui.actionView.conditionStar.x=320;else if(2==i){var n=GameDataManager.instance.getModeRecordDataById(t.id);HelpUtil.gethelplist(helpUnlock+t.id).then(function(i){i&&i.length>=e[1]&&(n.lock=[]),n.invite!=i.length&&(n.invite=i.length,GameDataManager.instance.recordModeById(t.id,n))}),this.ui.actionView.conditionLabel.text="邀请好友解锁篇章（"+n.invite+"/"+e[1]+"）",this.ui.actionView.conditionStar.visible=!1,this.ui.actionView.btnStart.visible=!1,this.ui.actionView.btnInvite.visible=!0}else{var a=GameDataManager.instance.chapterStarProgress(t.id);this.ui.actionView.btnStart.visible=!0,this.ui.actionView.btnInvite.visible=!1,this.ui.actionView.conditionStar.visible=!0,this.ui.actionView.conditionLabel.text="      "+a[0]+"/"+a[1],this.ui.actionView.conditionStar.x=320}},e.prototype.onResume=function(){this.showRecommend(),this.updateTopUi(),this.showMoveStar(),this.ui.actionView.chapList.refresh(),this.checkCurrentModeStatus()},e.prototype.clickRecommend=function(){var t=this;void 0!=this.recommendApp&&(this.recommendApp.appid&&""!=this.recommendApp.appid?wx.navigateToMiniProgram({appid:this.recommendApp.appid,path:this.recommendApp.path,success:function(t){},fail:function(e){wx.previewImage({urls:[t.recommendApp.poster]})}}):wx.previewImage({urls:[this.recommendApp.poster]}))},e.prototype.showRecommend=function(){var t=yxmp.asset.getRecommendApp("home");t&&t.icon?(this.ui.recommendImg.skin=t.icon,this.ui.recommendImg.visible=!0,this.recommendApp=t):this.ui.recommendImg.visible=!1},e.prototype.showMoveStar=function(){Star.shine(30,this.ui.bgView)},e}(xframe.XWindow);