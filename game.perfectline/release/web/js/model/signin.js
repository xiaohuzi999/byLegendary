var SigninManager,SignKey="signrecord",HadRole="haveGetRole";!function(a){function e(a,e){n(!1,function(){a<=0&&(a=t(D)),n(!1,function(){var a=r(D);DataManager.getData("signin-"+a)})})}function n(a,e){if(D>0)e&&e();else if(a){var t=new Date;D=t.getTime(),e&&e()}else yxmp.api.getServerTime().then(function(a){a.data&&a.data&&a.data.time?(D=1e3*a.data.time,e&&e()):n(!0,e)}).catch(function(a){n(!0,e)})}function t(a){var e=new Date(a).getDay();return 0==e&&(e=7),e}function r(a){var e=a,n=t(a),r=new Date(e+864e5*(7-n));return r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()}function i(a,e){return new Date(a).toDateString()===new Date(e).toDateString()}function g(){var a=DataManager.getData(SignKey);if(a&&a.length>0){var e=a[a.length-1],n=parseInt(e.time);if(i(GameDataManager.instance.serverTime,n))return!0}return!1}var D=0;a.signinState=e,a.signin=function(a,i){n(!1,function(){r(D),a<=0&&(a=t(D)),e(a)})},a.sign=function(a){var e=new Object,n=DataManager.getData(SignKey);n||(n=[]);var t=GameDataManager.instance.serverTime,r=a.id;e.time=t,e.signId=r,n.push(e),DataManager.setData(SignKey,n),n.length>=7&&!DataManager.getData(HadRole)&&3==a.type&&(DataManager.setData(HadRole,a),GameDataManager.instance.recordUserRolesData({id:a.target}))},a.checkSignBreak=function(){var a=DataManager.getData(SignKey);if(!a||0==a.length)return!0;if(g())return!1;var e=a[a.length-1],n=parseInt(e.time),t=function(a,e){return(a-n)/864e5>=2||!i(a,n+864e5)}(GameDataManager.instance.serverTime);return t?DataManager.setData(SignKey,[]):7==a.length&&DataManager.setData(SignKey,[]),t},a.isToday=i,a.hadSign=g,a.signIndex=function(){var a=DataManager.getData(SignKey);return a&&0!=a.length?a.length:0}}(SigninManager||(SigninManager={}));